{"ast":null,"code":"\"use strict\";\n\nvar typpy = require(\"typpy\"),\n    iterateObj = require(\"iterate-object\"),\n    Err = require(\"err\"),\n    objDef = require(\"obj-def\"),\n    emptyObj = require(\"is-empty-obj\"),\n    cheerio = require(\"cheerio\");\n/**\n * scrapeItCore\n * The core scraping functionality of `scrape-it`.\n *\n * Scrapes the data in the provided element.\n *\n * For the format of the selector, please refer to the [Selectors section of the Cheerio library](https://github.com/cheeriojs/cheerio#-selector-context-root-)\n *\n * @name scrapeIt.scrapeHTML\n * @function\n * @param {Cheerio|String} $ The input element or the HTML as a string.\n * @param {Object} opts An object containing the scraping information.\n *\n *   If you want to scrape a list, you have to use the `listItem` selector:\n *\n *    - `listItem` (String): The list item selector.\n *    - `data` (Object): The fields to include in the list objects:\n *       - `<fieldName>` (Object|String): The selector or an object containing:\n *          - `selector` (String): The selector.\n *          - `convert` (Function): An optional function to change the value.\n *          - `how` (Function|String): A function or function name to access the\n *            value.\n *          - `attr` (String): If provided, the value will be taken based on\n *            the attribute name.\n *          - `trim` (Boolean): If `false`, the value will *not* be trimmed\n *            (default: `true`).\n *          - `closest` (String): If provided, returns the first ancestor of\n *            the given element.\n *          - `eq` (Number): If provided, it will select the *nth* element.\n *          - `texteq` (Number): If provided, it will select the *nth* direct text child.\n *            Deep text child selection is not possible yet.\n *            Overwrites the `how` key.\n *          - `listItem` (Object): An object, keeping the recursive schema of\n *            the `listItem` object. This can be used to create nested lists.\n *\n *   **Example**:\n *   ```js\n *   {\n *      articles: {\n *          listItem: \".article\"\n *        , data: {\n *              createdAt: {\n *                  selector: \".date\"\n *                , convert: x => new Date(x)\n *              }\n *            , title: \"a.article-title\"\n *            , tags: {\n *                  listItem: \".tags > span\"\n *              }\n *            , content: {\n *                  selector: \".article-content\"\n *                , how: \"html\"\n *              }\n *            , traverseOtherNode: {\n *                  selector: \".upperNode\"\n *                , closest: \"div\"\n *                , convert: x => x.length\n *              }\n *          }\n *      }\n *   }\n *   ```\n *\n *   If you want to collect specific data from the page, just use the same\n *   schema used for the `data` field.\n *\n *   **Example**:\n *   ```js\n *   {\n *        title: \".header h1\"\n *      , desc: \".header h2\"\n *      , avatar: {\n *            selector: \".header img\"\n *          , attr: \"src\"\n *        }\n *   }\n *   ```\n *\n *\n * @name scrapeItCore\n * @function\n * @returns {Object} The scraped data.\n */\n\n\nmodule.exports = function ($, opts) {\n  if (typeof $ === \"string\") {\n    $ = cheerio.load($);\n  } // Normalizes the option\n\n\n  var normalizeOpt = function normalizeOpt(v) {\n    if (typpy(v, String)) {\n      v = {\n        selector: v\n      };\n    }\n\n    objDef(v, \"data\", {});\n    objDef(v, \"how\", \"text\", true);\n\n    if (v.attr) {\n      v.how = function ($elm) {\n        return $elm.attr(v.attr);\n      };\n    }\n\n    objDef(v, \"trimValue\", true);\n    objDef(v, \"closest\", \"\");\n    return v;\n  }; // Recursively handles the data\n\n\n  var handleDataObj = function handleDataObj(data, $context) {\n    var pageData = {};\n    iterateObj(data, function (cOpt, optName) {\n      cOpt = normalizeOpt(cOpt);\n      cOpt.name = optName;\n      var $cContext = $context === $ ? undefined : $context;\n\n      if (!$cContext && !cOpt.selector && !cOpt.listItem) {\n        throw new Err(\"There is no element selected for the '<option.name>' field. Please provide a selector, list item or use nested object structure.\", {\n          option: cOpt,\n          code: \"NO_ELEMENT_SELECTED\"\n        });\n      }\n\n      var $elm = cOpt.selector ? $(cOpt.selector, $cContext) : $cContext; // Handle lists\n\n      if (cOpt.listItem) {\n        var docs = pageData[cOpt.name] = [],\n            $items = $(cOpt.listItem, $cContext),\n            isEmpty = emptyObj(cOpt.data);\n\n        if (isEmpty) {\n          cOpt.data.___raw = {};\n        }\n\n        for (var i = 0; i < $items.length; ++i) {\n          var cDoc = handleDataObj(cOpt.data, $items.eq(i));\n\n          var convert = cOpt.convert || function (x) {\n            return x;\n          };\n\n          docs.push(convert(cDoc.___raw || cDoc));\n        }\n      } else {\n        if (typpy(cOpt.eq, Number)) {\n          $elm = $elm.eq(cOpt.eq);\n        }\n\n        if (typpy(cOpt.texteq, Number)) {\n          var children = $elm.contents(),\n              textCounter = 0,\n              found = false;\n\n          for (var _i = 0, child; child = children[_i]; _i++) {\n            if (child.type === \"text\") {\n              if (textCounter == cOpt.texteq) {\n                $elm = child;\n                found = true;\n                break;\n              }\n\n              textCounter++;\n            }\n          }\n\n          if (!found) {\n            $elm = cheerio.load(\"\");\n          }\n\n          cOpt.how = function (elm) {\n            return elm.data;\n          };\n        } // Handle closest\n\n\n        if (cOpt.closest) {\n          $elm = $elm.closest(cOpt.closest);\n        }\n\n        if (!emptyObj(cOpt.data)) {\n          pageData[cOpt.name] = handleDataObj(cOpt.data, $elm);\n          return pageData;\n        }\n\n        var value = typpy(cOpt.how, Function) ? cOpt.how($elm) : $elm[cOpt.how]();\n        value = value === undefined ? \"\" : value;\n\n        if (cOpt.trimValue && typpy(value, String)) {\n          value = value.trim();\n        }\n\n        if (cOpt.convert) {\n          value = cOpt.convert(value, $elm);\n        }\n\n        pageData[cOpt.name] = value;\n      }\n    });\n    return pageData;\n  };\n\n  return handleDataObj(opts);\n};","map":{"version":3,"sources":["C:/Users/narut/Documents/Coding/stock-calc/node_modules/scrape-it-core/lib/index.js"],"names":["typpy","require","iterateObj","Err","objDef","emptyObj","cheerio","module","exports","$","opts","load","normalizeOpt","v","String","selector","attr","how","$elm","handleDataObj","data","$context","pageData","cOpt","optName","name","$cContext","undefined","listItem","option","code","docs","$items","isEmpty","___raw","i","length","cDoc","eq","convert","x","push","Number","texteq","children","contents","textCounter","found","_i","child","type","elm","closest","value","Function","trimValue","trim"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar typpy = require(\"typpy\"),\n    iterateObj = require(\"iterate-object\"),\n    Err = require(\"err\"),\n    objDef = require(\"obj-def\"),\n    emptyObj = require(\"is-empty-obj\"),\n    cheerio = require(\"cheerio\");\n\n/**\n * scrapeItCore\n * The core scraping functionality of `scrape-it`.\n *\n * Scrapes the data in the provided element.\n *\n * For the format of the selector, please refer to the [Selectors section of the Cheerio library](https://github.com/cheeriojs/cheerio#-selector-context-root-)\n *\n * @name scrapeIt.scrapeHTML\n * @function\n * @param {Cheerio|String} $ The input element or the HTML as a string.\n * @param {Object} opts An object containing the scraping information.\n *\n *   If you want to scrape a list, you have to use the `listItem` selector:\n *\n *    - `listItem` (String): The list item selector.\n *    - `data` (Object): The fields to include in the list objects:\n *       - `<fieldName>` (Object|String): The selector or an object containing:\n *          - `selector` (String): The selector.\n *          - `convert` (Function): An optional function to change the value.\n *          - `how` (Function|String): A function or function name to access the\n *            value.\n *          - `attr` (String): If provided, the value will be taken based on\n *            the attribute name.\n *          - `trim` (Boolean): If `false`, the value will *not* be trimmed\n *            (default: `true`).\n *          - `closest` (String): If provided, returns the first ancestor of\n *            the given element.\n *          - `eq` (Number): If provided, it will select the *nth* element.\n *          - `texteq` (Number): If provided, it will select the *nth* direct text child.\n *            Deep text child selection is not possible yet.\n *            Overwrites the `how` key.\n *          - `listItem` (Object): An object, keeping the recursive schema of\n *            the `listItem` object. This can be used to create nested lists.\n *\n *   **Example**:\n *   ```js\n *   {\n *      articles: {\n *          listItem: \".article\"\n *        , data: {\n *              createdAt: {\n *                  selector: \".date\"\n *                , convert: x => new Date(x)\n *              }\n *            , title: \"a.article-title\"\n *            , tags: {\n *                  listItem: \".tags > span\"\n *              }\n *            , content: {\n *                  selector: \".article-content\"\n *                , how: \"html\"\n *              }\n *            , traverseOtherNode: {\n *                  selector: \".upperNode\"\n *                , closest: \"div\"\n *                , convert: x => x.length\n *              }\n *          }\n *      }\n *   }\n *   ```\n *\n *   If you want to collect specific data from the page, just use the same\n *   schema used for the `data` field.\n *\n *   **Example**:\n *   ```js\n *   {\n *        title: \".header h1\"\n *      , desc: \".header h2\"\n *      , avatar: {\n *            selector: \".header img\"\n *          , attr: \"src\"\n *        }\n *   }\n *   ```\n *\n *\n * @name scrapeItCore\n * @function\n * @returns {Object} The scraped data.\n */\nmodule.exports = function ($, opts) {\n\n    if (typeof $ === \"string\") {\n        $ = cheerio.load($);\n    }\n\n    // Normalizes the option\n    var normalizeOpt = function normalizeOpt(v) {\n        if (typpy(v, String)) {\n            v = { selector: v };\n        }\n        objDef(v, \"data\", {});\n        objDef(v, \"how\", \"text\", true);\n        if (v.attr) {\n            v.how = function ($elm) {\n                return $elm.attr(v.attr);\n            };\n        }\n        objDef(v, \"trimValue\", true);\n        objDef(v, \"closest\", \"\");\n        return v;\n    };\n\n    // Recursively handles the data\n    var handleDataObj = function handleDataObj(data, $context) {\n        var pageData = {};\n        iterateObj(data, function (cOpt, optName) {\n\n            cOpt = normalizeOpt(cOpt);\n            cOpt.name = optName;\n\n            var $cContext = $context === $ ? undefined : $context;\n            if (!$cContext && !cOpt.selector && !cOpt.listItem) {\n                throw new Err(\"There is no element selected for the '<option.name>' field. Please provide a selector, list item or use nested object structure.\", {\n                    option: cOpt,\n                    code: \"NO_ELEMENT_SELECTED\"\n                });\n            }\n\n            var $elm = cOpt.selector ? $(cOpt.selector, $cContext) : $cContext;\n\n            // Handle lists\n            if (cOpt.listItem) {\n                var docs = pageData[cOpt.name] = [],\n                    $items = $(cOpt.listItem, $cContext),\n                    isEmpty = emptyObj(cOpt.data);\n\n                if (isEmpty) {\n                    cOpt.data.___raw = {};\n                }\n\n                for (var i = 0; i < $items.length; ++i) {\n                    var cDoc = handleDataObj(cOpt.data, $items.eq(i));\n                    var convert = cOpt.convert || function (x) {\n                        return x;\n                    };\n                    docs.push(convert(cDoc.___raw || cDoc));\n                }\n            } else {\n\n                if (typpy(cOpt.eq, Number)) {\n                    $elm = $elm.eq(cOpt.eq);\n                }\n\n                if (typpy(cOpt.texteq, Number)) {\n                    var children = $elm.contents(),\n                        textCounter = 0,\n                        found = false;\n\n                    for (var _i = 0, child; child = children[_i]; _i++) {\n                        if (child.type === \"text\") {\n                            if (textCounter == cOpt.texteq) {\n                                $elm = child;\n                                found = true;\n                                break;\n                            }\n                            textCounter++;\n                        }\n                    }\n\n                    if (!found) {\n                        $elm = cheerio.load(\"\");\n                    }\n\n                    cOpt.how = function (elm) {\n                        return elm.data;\n                    };\n                }\n\n                // Handle closest\n                if (cOpt.closest) {\n                    $elm = $elm.closest(cOpt.closest);\n                }\n\n                if (!emptyObj(cOpt.data)) {\n                    pageData[cOpt.name] = handleDataObj(cOpt.data, $elm);\n                    return pageData;\n                }\n\n                var value = typpy(cOpt.how, Function) ? cOpt.how($elm) : $elm[cOpt.how]();\n                value = value === undefined ? \"\" : value;\n                if (cOpt.trimValue && typpy(value, String)) {\n                    value = value.trim();\n                }\n\n                if (cOpt.convert) {\n                    value = cOpt.convert(value, $elm);\n                }\n\n                pageData[cOpt.name] = value;\n            }\n        });\n        return pageData;\n    };\n\n    return handleDataObj(opts);\n};"]},"metadata":{},"sourceType":"script"}