{"ast":null,"code":"import _objectSpread from\"C:/Users/narut/Documents/Coding/stock-calc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/Users/narut/Documents/Coding/stock-calc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import Chart from\"kaktana-react-lightweight-charts\";import{createChart,LineStyle}from\"lightweight-charts\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var LightChart=function LightChart(_ref){var _quoteSpark$close,_quoteSummary$incomeS,_quoteSummary$incomeS2;var quoteSpark=_ref.quoteSpark,setRangeChart=_ref.setRangeChart,quoteSummary=_ref.quoteSummary;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),chartData=_useState2[0],setChartData=_useState2[1];var convertDate=function convertDate(value){var result=new Date(value*1000);var date=result.getDate();var month=result.getMonth()+1;var year=result.getFullYear();if(date<10){date=\"0\"+date;}if(month<10){month=\"0\"+month;}return\"\".concat(year,\"-\").concat(month,\"-\").concat(date);};var convertNumberRound=function convertNumberRound(value){return Math.round(value*100)/100;};var getStandardDeviation=function getStandardDeviation(dataArray){var n=dataArray===null||dataArray===void 0?void 0:dataArray.length;var mean=(dataArray===null||dataArray===void 0?void 0:dataArray.reduce(function(a,b){return a+b;}))/n;return+Math.sqrt((dataArray===null||dataArray===void 0?void 0:dataArray.map(function(x){return Math.pow(x-mean,2);}).reduce(function(a,b){return a+b;}))/n);};var getPrice=quoteSpark===null||quoteSpark===void 0?void 0:(_quoteSpark$close=quoteSpark.close)===null||_quoteSpark$close===void 0?void 0:_quoteSpark$close.map(function(item,index){return{price:item,date:convertDate(quoteSpark.timestamp[index]),year:new Date(quoteSpark.timestamp[index]*1000).getFullYear()};});var getEPS=quoteSummary===null||quoteSummary===void 0?void 0:(_quoteSummary$incomeS=quoteSummary.incomeStatementHistory)===null||_quoteSummary$incomeS===void 0?void 0:(_quoteSummary$incomeS2=_quoteSummary$incomeS.incomeStatementHistory)===null||_quoteSummary$incomeS2===void 0?void 0:_quoteSummary$incomeS2.map(function(item,index){return{eps:item.netIncome.raw/(quoteSummary===null||quoteSummary===void 0?void 0:quoteSummary.defaultKeyStatistics.sharesOutstanding.raw),year:new Date(item.endDate.raw*1000).getFullYear()};}).concat({eps:quoteSummary===null||quoteSummary===void 0?void 0:quoteSummary.defaultKeyStatistics.trailingEps.raw,year:new Date().getFullYear()}).sort(function(a,b){return a.year-b.year;});var getPE=getPrice===null||getPrice===void 0?void 0:getPrice.map(function(item,index){var resEps=getEPS===null||getEPS===void 0?void 0:getEPS.find(function(data){return data.year===item.year;});var resPe=resEps?+item.price/+resEps.eps:null;return _objectSpread(_objectSpread({},item),{},{eps:resEps?resEps.eps:null,pe:resPe?convertNumberRound(resPe):resPe});});var purePE=getPE===null||getPE===void 0?void 0:getPE.filter(function(item){return item.pe;});var getSD=getPE===null||getPE===void 0?void 0:getPE.map(function(item){var _purePE$map;var n=purePE===null||purePE===void 0?void 0:purePE.length;var meanPE=(purePE===null||purePE===void 0?void 0:(_purePE$map=purePE.map(function(item){return item.pe;}))===null||_purePE$map===void 0?void 0:_purePE$map.reduce(function(a,b){return+a+ +b;}))/+n;var pe=purePE.map(function(item){return item.pe;});return _objectSpread(_objectSpread({},item),{},{sd:convertNumberRound(meanPE),sd1p:convertNumberRound(meanPE+getStandardDeviation(pe)),sd2p:convertNumberRound(meanPE+getStandardDeviation(pe)*2),sd1m:convertNumberRound(meanPE-getStandardDeviation(pe)),sd2m:convertNumberRound(meanPE-getStandardDeviation(pe)*2)});});var generateChart=function generateChart(){var datas=getSD.map(function(item){return{time:item.date,value:item.pe};});setChartData([{legend:\"P/E\",data:datas,priceLines:[{title:\"+2SD\",price:getSD[0].sd2p,color:\"gray\",lineWidth:2,lineStyle:LineStyle.Dotted,axisLabelVisible:true},{price:getSD[0].sd1p,color:\"gray\",lineWidth:2,lineStyle:LineStyle.Dotted,axisLabelVisible:true,title:\"+1SD\"},{price:getSD[0].sd,color:\"gray\",lineWidth:2,lineStyle:LineStyle.Dotted,axisLabelVisible:true,title:\"Average\"},{price:getSD[0].sd1m,color:\"gray\",lineWidth:2,lineStyle:LineStyle.Dotted,axisLabelVisible:true,title:\"-1SD\"},{price:getSD[0].sd2m,color:\"gray\",lineWidth:2,lineStyle:LineStyle.Dotted,axisLabelVisible:true,title:\"-2SD\"}]}]);};var options={alignLabels:true,timeScale:{rightOffset:12,barSpacing:3,fixLeftEdge:false,lockVisibleTimeRangeOnResize:true,rightBarStaysOnScroll:true,borderVisible:false,borderColor:\"#fff000\",visible:true,timeVisible:true,secondsVisible:false},priceScale:{autoScale:true}};useEffect(function(){generateChart();},[quoteSpark]);var displayRange=/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-around align-items-center my-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(ev){return setRangeChart(ev.target.value);},name:\"range-chart\",type:\"radio\",className:\"btn-check\",id:\"range-1y\",value:\"1y\"}),/*#__PURE__*/_jsx(\"label\",{className:\"btn btn-outline-primary btn-sm px-5\",htmlFor:\"range-1y\",children:\"1Y\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(ev){return setRangeChart(ev.target.value);},name:\"range-chart\",type:\"radio\",className:\"btn-check\",id:\"range-3y\",value:\"3y\",defaultChecked:true}),/*#__PURE__*/_jsx(\"label\",{className:\"btn btn-outline-primary btn-sm px-5\",htmlFor:\"range-3y\",children:\"3Y\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(ev){return setRangeChart(ev.target.value);},name:\"range-chart\",type:\"radio\",className:\"btn-check\",id:\"range-5y\",value:\"5y\"}),/*#__PURE__*/_jsx(\"label\",{className:\"btn btn-outline-primary btn-sm px-5\",htmlFor:\"range-5y\",children:\"5Y\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(ev){return setRangeChart(ev.target.value);},name:\"range-chart\",type:\"radio\",className:\"btn-check\",id:\"range-max\",value:\"max\"}),/*#__PURE__*/_jsx(\"label\",{className:\"btn btn-outline-primary btn-sm px-5\",htmlFor:\"range-max\",children:\"Max\"})]})]});return/*#__PURE__*/_jsx(\"div\",{children:quoteSpark?/*#__PURE__*/_jsxs(_Fragment,{children:[displayRange,/*#__PURE__*/_jsx(\"div\",{id:\"stock-chart\",className:\"shadow my-1 px-4 py-2\",children:/*#__PURE__*/_jsx(Chart,{options:options,lineSeries:chartData,autoWidth:true,height:300,from:\"\".concat(new Date().getFullYear()-4,\"-01-01\"),to:convertDate(new Date())})})]}):\"\"});};export default LightChart;","map":{"version":3,"sources":["C:/Users/narut/Documents/Coding/stock-calc/src/Component/LightChart.js"],"names":["React","useState","useEffect","Chart","createChart","LineStyle","LightChart","quoteSpark","setRangeChart","quoteSummary","chartData","setChartData","convertDate","value","result","Date","date","getDate","month","getMonth","year","getFullYear","convertNumberRound","Math","round","getStandardDeviation","dataArray","n","length","mean","reduce","a","b","sqrt","map","x","pow","getPrice","close","item","index","price","timestamp","getEPS","incomeStatementHistory","eps","netIncome","raw","defaultKeyStatistics","sharesOutstanding","endDate","concat","trailingEps","sort","getPE","resEps","find","data","resPe","pe","purePE","filter","getSD","meanPE","sd","sd1p","sd2p","sd1m","sd2m","generateChart","datas","time","legend","priceLines","title","color","lineWidth","lineStyle","Dotted","axisLabelVisible","options","alignLabels","timeScale","rightOffset","barSpacing","fixLeftEdge","lockVisibleTimeRangeOnResize","rightBarStaysOnScroll","borderVisible","borderColor","visible","timeVisible","secondsVisible","priceScale","autoScale","displayRange","ev","target"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport Chart from \"kaktana-react-lightweight-charts\";\r\nimport { createChart, LineStyle } from \"lightweight-charts\";\r\n\r\nconst LightChart = ({ quoteSpark, setRangeChart, quoteSummary }) => {\r\n  const [chartData, setChartData] = useState([]);\r\n\r\n  const convertDate = (value) => {\r\n    const result = new Date(value * 1000);\r\n\r\n    let date = result.getDate();\r\n    let month = result.getMonth() + 1;\r\n    let year = result.getFullYear();\r\n\r\n    if (date < 10) {\r\n      date = \"0\" + date;\r\n    }\r\n    if (month < 10) {\r\n      month = \"0\" + month;\r\n    }\r\n\r\n    return `${year}-${month}-${date}`;\r\n  };\r\n\r\n  const convertNumberRound = (value) => {\r\n    return Math.round(value * 100) / 100;\r\n  };\r\n\r\n  const getStandardDeviation = (dataArray) => {\r\n    const n = dataArray?.length;\r\n    const mean = dataArray?.reduce((a, b) => a + b) / n;\r\n    return +Math.sqrt(\r\n      dataArray?.map((x) => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n\r\n    );\r\n  };\r\n\r\n  const getPrice = quoteSpark?.close?.map((item, index) => {\r\n    return {\r\n      price: item,\r\n      date: convertDate(quoteSpark.timestamp[index]),\r\n      year: new Date(quoteSpark.timestamp[index] * 1000).getFullYear(),\r\n    };\r\n  });\r\n\r\n  const getEPS = quoteSummary?.incomeStatementHistory?.incomeStatementHistory\r\n    ?.map((item, index) => {\r\n      return {\r\n        eps:\r\n          item.netIncome.raw /\r\n          quoteSummary?.defaultKeyStatistics.sharesOutstanding.raw,\r\n        year: new Date(item.endDate.raw * 1000).getFullYear(),\r\n      };\r\n    })\r\n    .concat({\r\n      eps: quoteSummary?.defaultKeyStatistics.trailingEps.raw,\r\n      year: new Date().getFullYear(),\r\n    })\r\n    .sort((a, b) => a.year - b.year);\r\n\r\n  const getPE = getPrice?.map((item, index) => {\r\n    const resEps = getEPS?.find((data) => data.year === item.year);\r\n    const resPe = resEps ? +item.price / +resEps.eps : null;\r\n\r\n    return {\r\n      ...item,\r\n      eps: resEps ? resEps.eps : null,\r\n      pe: resPe ? convertNumberRound(resPe) : resPe,\r\n    };\r\n  });\r\n\r\n  const purePE = getPE?.filter((item) => item.pe);\r\n\r\n  const getSD = getPE?.map((item) => {\r\n    const n = purePE?.length;\r\n    const meanPE =\r\n      purePE?.map((item) => item.pe)?.reduce((a, b) => +a + +b) / +n;\r\n\r\n    const pe = purePE.map((item) => item.pe);\r\n\r\n    return {\r\n      ...item,\r\n      sd: convertNumberRound(meanPE),\r\n      sd1p: convertNumberRound(meanPE + getStandardDeviation(pe)),\r\n      sd2p: convertNumberRound(meanPE + getStandardDeviation(pe) * 2),\r\n      sd1m: convertNumberRound(meanPE - getStandardDeviation(pe)),\r\n      sd2m: convertNumberRound(meanPE - getStandardDeviation(pe) * 2),\r\n    };\r\n  });\r\n\r\n  const generateChart = () => {\r\n    const datas = getSD.map((item) => {\r\n      return {\r\n        time: item.date,\r\n        value: item.pe,\r\n      };\r\n    });\r\n    setChartData([\r\n      {\r\n        legend: \"P/E\",\r\n        data: datas,\r\n        priceLines: [\r\n          {\r\n            title: \"+2SD\",\r\n            price: getSD[0].sd2p,\r\n            color: \"gray\",\r\n            lineWidth: 2,\r\n            lineStyle: LineStyle.Dotted,\r\n            axisLabelVisible: true,\r\n          },\r\n          {\r\n            price: getSD[0].sd1p,\r\n            color: \"gray\",\r\n            lineWidth: 2,\r\n            lineStyle: LineStyle.Dotted,\r\n            axisLabelVisible: true,\r\n            title: \"+1SD\",\r\n          },\r\n          {\r\n            price: getSD[0].sd,\r\n            color: \"gray\",\r\n            lineWidth: 2,\r\n            lineStyle: LineStyle.Dotted,\r\n            axisLabelVisible: true,\r\n            title: \"Average\",\r\n          },\r\n          {\r\n            price: getSD[0].sd1m,\r\n            color: \"gray\",\r\n            lineWidth: 2,\r\n            lineStyle: LineStyle.Dotted,\r\n            axisLabelVisible: true,\r\n            title: \"-1SD\",\r\n          },\r\n          {\r\n            price: getSD[0].sd2m,\r\n            color: \"gray\",\r\n            lineWidth: 2,\r\n            lineStyle: LineStyle.Dotted,\r\n            axisLabelVisible: true,\r\n            title: \"-2SD\",\r\n          },\r\n        ],\r\n      },\r\n    ]);\r\n  };\r\n\r\n  const options = {\r\n    alignLabels: true,\r\n    timeScale: {\r\n      rightOffset: 12,\r\n      barSpacing: 3,\r\n      fixLeftEdge: false,\r\n      lockVisibleTimeRangeOnResize: true,\r\n      rightBarStaysOnScroll: true,\r\n      borderVisible: false,\r\n      borderColor: \"#fff000\",\r\n      visible: true,\r\n      timeVisible: true,\r\n      secondsVisible: false,\r\n    },\r\n    priceScale: {\r\n      autoScale: true,\r\n    },\r\n  };\r\n\r\n  useEffect(() => {\r\n    generateChart();\r\n  }, [quoteSpark]);\r\n\r\n  const displayRange = (\r\n    <div className=\"d-flex justify-content-around align-items-center my-1\">\r\n      <div>\r\n        <input\r\n          onChange={(ev) => setRangeChart(ev.target.value)}\r\n          name=\"range-chart\"\r\n          type=\"radio\"\r\n          className=\"btn-check\"\r\n          id=\"range-1y\"\r\n          value=\"1y\"\r\n        />\r\n        <label\r\n          className=\"btn btn-outline-primary btn-sm px-5\"\r\n          htmlFor=\"range-1y\"\r\n        >\r\n          1Y\r\n        </label>\r\n      </div>\r\n      <div>\r\n        <input\r\n          onChange={(ev) => setRangeChart(ev.target.value)}\r\n          name=\"range-chart\"\r\n          type=\"radio\"\r\n          className=\"btn-check\"\r\n          id=\"range-3y\"\r\n          value=\"3y\"\r\n          defaultChecked\r\n        />\r\n        <label\r\n          className=\"btn btn-outline-primary btn-sm px-5\"\r\n          htmlFor=\"range-3y\"\r\n        >\r\n          3Y\r\n        </label>\r\n      </div>\r\n      <div>\r\n        <input\r\n          onChange={(ev) => setRangeChart(ev.target.value)}\r\n          name=\"range-chart\"\r\n          type=\"radio\"\r\n          className=\"btn-check\"\r\n          id=\"range-5y\"\r\n          value=\"5y\"\r\n        />\r\n        <label\r\n          className=\"btn btn-outline-primary btn-sm px-5\"\r\n          htmlFor=\"range-5y\"\r\n        >\r\n          5Y\r\n        </label>\r\n      </div>\r\n      <div>\r\n        <input\r\n          onChange={(ev) => setRangeChart(ev.target.value)}\r\n          name=\"range-chart\"\r\n          type=\"radio\"\r\n          className=\"btn-check\"\r\n          id=\"range-max\"\r\n          value=\"max\"\r\n        />\r\n        <label\r\n          className=\"btn btn-outline-primary btn-sm px-5\"\r\n          htmlFor=\"range-max\"\r\n        >\r\n          Max\r\n        </label>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div>\r\n      {quoteSpark ? (\r\n        <>\r\n          {displayRange}\r\n          <div id=\"stock-chart\" className=\"shadow my-1 px-4 py-2\">\r\n            <Chart\r\n              options={options}\r\n              lineSeries={chartData}\r\n              autoWidth\r\n              height={300}\r\n              from={`${new Date().getFullYear() - 4}-01-01`}\r\n              to={convertDate(new Date())}\r\n            />\r\n          </div>\r\n        </>\r\n      ) : (\r\n        \"\"\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LightChart;\r\n"]},"metadata":{},"sourceType":"module"}